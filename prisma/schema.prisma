// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Opportunity {
  id              String    @id @default(cuid())
  name            String
  value           Float?
  company         String?
  referredBy      String?
  leadSourceType  String?
  contact         String?
  contactId       String?
  linkedContact   Contact?  @relation(fields: [contactId], references: [id])
  completedAt     DateTime?
  stage           String    @default("00 - Id√©es de contact")
  proposal        String?   @db.Text
  assignee        String?
  closedDate      DateTime?
  openDate        DateTime?
  region          String?
  segment         String?
  proposalSentDate DateTime?
  projectType     String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([stage])
  @@index([region])
  @@index([segment])
  @@index([contactId])
}

model Contact {
  id                String    @id @default(cuid())
  fullName          String
  firstName         String?
  lastName          String?
  level             Int?
  potentialSale     Boolean   @default(false)
  photoUrl          String?
  linkedinUrl       String?
  position          String?
  company           String?
  email             String?
  phone             String?
  relation          String?
  circles           String?
  employmentField   String?
  lastUpdated       DateTime?
  region            String?
  birthday          String?
  link              String?
  tags              String?
  linkedOpportunities String?
  projects          String?
  language          String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  opportunities     Opportunity[]

  @@index([region])
  @@index([employmentField])
  @@index([company])
}

model Project {
  id              String    @id @default(cuid())
  name            String
  client          String?
  team            String?
  status          String?
  stage           String?
  billing         String?
  lead            String?
  clientComm      String?
  contactName     String?
  contactMethod   String?
  hourlyRate      Float?
  proposalUrl     String?
  budget          String?
  driveUrl        String?
  asanaUrl        String?
  slackUrl        String?
  timeline        String?
  projectType     String?
  year            String?
  description     String?   @db.Text
  brief           String?   @db.Text
  testimonial     String?
  portfolio       String?
  report          String?
  communication   String?
  departments     String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  tasks           Task[]

  @@index([status])
  @@index([projectType])
  @@index([client])
  @@index([year])
}

model Company {
  id                String    @id @default(cuid())
  name              String
  logoUrl           String?
  website           String?
  address           String?
  phone             String?
  type              String?
  mainContactName   String?
  mainContactEmail  String?
  description       String?   @db.Text
  industry          String?
  insight           String?   @db.Text
  engagements       String?   @db.Text
  linkedinUrl       String?
  facebookUrl       String?
  instagramUrl      String?
  agencyPartners    String?
  referralPartners  String?
  isClient          Boolean   @default(false)
  testimonials      String?
  events            String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  @@index([type])
  @@index([industry])
  @@index([isClient])
}

// Departments: Lab, Bureau, Studio
model Employee {
  id            String    @id @default(cuid())
  name          String
  email         String?
  photoUrl      String?
  role          String?
  department    String    // Lab, Bureau, Studio
  currentTaskId String?   @unique // Only one current task per employee
  currentTask   Task?     @relation("CurrentTask", fields: [currentTaskId], references: [id])
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@index([department])
}

// Task zones: current, shelf, storage, dock
model Task {
  id            String    @id @default(cuid())
  title         String
  description   String?   @db.Text
  zone          String    @default("shelf") // current, shelf, storage, dock
  department    String    // Lab, Bureau, Studio
  projectId     String?
  project       Project?  @relation(fields: [projectId], references: [id])
  priority      String?   @default("medium") // low, medium, high
  dueDate       DateTime?
  order         Int       @default(0)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  assignedEmployee Employee? @relation("CurrentTask")

  @@index([zone])
  @@index([department])
  @@index([projectId])
}
